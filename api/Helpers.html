---
layout: default
title: "Helpers API"
categories:
  - api
---
   <div class="row-fluid">     <div class="page-title documentation-page-title">       <div class="container">         <h1 class="page-title__title">API Documentation</h1>         <a href="https://github.com/noflo/noflo/blob/master/src/lib/Helpers.coffee" class="btn btn-primary page-title__button big-button">On GitHub</a>       </div>     </div>   </div>    <div class="row-fluid">     <div class="container documentation-main-container">       <div class="main">         <div class="sidebar span4">                    <nav>             <ul class="sidebar__nav">                                                                  <li>                   <a {% if page.url == '/api/ArrayPort.html' %}class="active" {% endif %}href="ArrayPort.html">                     ArrayPort                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/AsyncComponent.html' %}class="active" {% endif %}href="AsyncComponent.html">                     AsyncComponent                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/BasePort.html' %}class="active" {% endif %}href="BasePort.html">                     BasePort                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/Component.html' %}class="active" {% endif %}href="Component.html">                     Component                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/ComponentLoader.html' %}class="active" {% endif %}href="ComponentLoader.html">                     ComponentLoader                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/Graph.html' %}class="active" {% endif %}href="Graph.html">                     Graph                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/Helpers.html' %}class="active" {% endif %}href="Helpers.html">                     Helpers                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/InPort.html' %}class="active" {% endif %}href="InPort.html">                     InPort                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/InternalSocket.html' %}class="active" {% endif %}href="InternalSocket.html">                     InternalSocket                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/Journal.html' %}class="active" {% endif %}href="Journal.html">                     Journal                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/LoggingComponent.html' %}class="active" {% endif %}href="LoggingComponent.html">                     LoggingComponent                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/Network.html' %}class="active" {% endif %}href="Network.html">                     Network                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/NoFlo.html' %}class="active" {% endif %}href="NoFlo.html">                     NoFlo                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/OutPort.html' %}class="active" {% endif %}href="OutPort.html">                     OutPort                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/Platform.html' %}class="active" {% endif %}href="Platform.html">                     Platform                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/Port.html' %}class="active" {% endif %}href="Port.html">                     Port                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/Ports.html' %}class="active" {% endif %}href="Ports.html">                     Ports                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/Streams.html' %}class="active" {% endif %}href="Streams.html">                     Streams                   </a>                 </li>                                                                                   <li>                   <a {% if page.url == '/api/Utils.html' %}class="active" {% endif %}href="Utils.html">                     Utils                   </a>                 </li>                                                                                              </ul>           </nav>                  </div>         <div class="content span8">           <h1>{{ page.title }}</h1>                                     <pre><code>NoFlo - Flow-Based Programming for JavaScript
(c) 2014 TheGrid (Rituwall Inc.)
NoFlo may be freely distributed under the MIT license
</code></pre>                            <div class="highlight"><pre><span class="nv">StreamSender = </span><span class="nx">require</span><span class="p">(</span><span class="s">&#39;./Streams&#39;</span><span class="p">).</span><span class="nx">StreamSender</span>
<span class="nv">StreamReceiver = </span><span class="nx">require</span><span class="p">(</span><span class="s">&#39;./Streams&#39;</span><span class="p">).</span><span class="nx">StreamReceiver</span></pre></div>                                                  <p>MapComponent maps a single inport to a single outport, forwarding all
groups from in to out and calling <code>func</code> on each incoming packet</p>                            <div class="highlight"><pre><span class="nv">exports.MapComponent = </span><span class="nf">(component, func, config) -&gt;</span>
  <span class="nv">config = </span><span class="p">{}</span> <span class="k">unless</span> <span class="nx">config</span>
  <span class="nv">config.inPort = </span><span class="s">&#39;in&#39;</span> <span class="k">unless</span> <span class="nx">config</span><span class="p">.</span><span class="nx">inPort</span>
  <span class="nv">config.outPort = </span><span class="s">&#39;out&#39;</span> <span class="k">unless</span> <span class="nx">config</span><span class="p">.</span><span class="nx">outPort</span>

  <span class="nv">inPort = </span><span class="nx">component</span><span class="p">.</span><span class="nx">inPorts</span><span class="p">[</span><span class="nx">config</span><span class="p">.</span><span class="nx">inPort</span><span class="p">]</span>
  <span class="nv">outPort = </span><span class="nx">component</span><span class="p">.</span><span class="nx">outPorts</span><span class="p">[</span><span class="nx">config</span><span class="p">.</span><span class="nx">outPort</span><span class="p">]</span>
  <span class="nv">groups = </span><span class="p">[]</span>
  <span class="nv">inPort.process = </span><span class="nf">(event, payload) -&gt;</span>
    <span class="k">switch</span> <span class="nx">event</span>
      <span class="k">when</span> <span class="s">&#39;connect&#39;</span> <span class="k">then</span> <span class="nx">outPort</span><span class="p">.</span><span class="nx">connect</span><span class="p">()</span>
      <span class="k">when</span> <span class="s">&#39;begingroup&#39;</span>
        <span class="nx">groups</span><span class="p">.</span><span class="nx">push</span> <span class="nx">payload</span>
        <span class="nx">outPort</span><span class="p">.</span><span class="nx">beginGroup</span> <span class="nx">payload</span>
      <span class="k">when</span> <span class="s">&#39;data&#39;</span>
        <span class="nx">func</span> <span class="nx">payload</span><span class="p">,</span> <span class="nx">groups</span><span class="p">,</span> <span class="nx">outPort</span>
      <span class="k">when</span> <span class="s">&#39;endgroup&#39;</span>
        <span class="nx">groups</span><span class="p">.</span><span class="nx">pop</span><span class="p">()</span>
        <span class="nx">outPort</span><span class="p">.</span><span class="nx">endGroup</span><span class="p">()</span>
      <span class="k">when</span> <span class="s">&#39;disconnect&#39;</span>
        <span class="nv">groups = </span><span class="p">[]</span>
        <span class="nx">outPort</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">()</span></pre></div>                                                  <p>WirePattern makes your component collect data from several inports
and activates a handler <code>proc</code> only when a tuple from all of these
ports is complete. The signature of handler function is:
<code>
proc = (combinedInputData, inputGroups, outputPorts, asyncCallback) -&gt;
</code></p>

<p>With <code>config.group = true</code> it checks incoming group IPs and collates
data with matching group IPs. By default this kind of grouping is <code>false</code>.
Set <code>config.group</code> to a RegExp object to correlate inputs only if the
group matches the expression (e.g. <code>^req_</code>). For non-matching groups
the component will act normally.</p>

<p>With `config.field = 'fieldName' it collates incoming data by specified
field. The component's proc function is passed a combined object with
port names used as keys. This kind of grouping is disabled by default.</p>

<p>With <code>config.forwardGroups = true</code> it would forward group IPs from
inputs to the output sending them along with the data. This option also
accepts string or array values, if you want to forward groups from specific
port(s) only. By default group forwarding is <code>false</code>.</p>

<p><code>config.receiveStreams = [portNames]</code> feature makes the component expect
substreams on specific inports instead of separate IPs (brackets and data).
It makes select inports emit <code>Substream</code> objects on <code>data</code> event
and silences <code>beginGroup</code> and <code>endGroup</code> events.</p>

<p><code>config.sendStreams = [portNames]</code> feature makes the component emit entire
substreams of packets atomically to the outport. Atomically means that a
substream cannot be interrupted by other packets, which is important when
doing asynchronous processing. In fact, <code>sendStreams</code> is enabled by default
on all outports when <code>config.async</code> is <code>true</code>.</p>

<p>WirePattern supports both sync and async <code>proc</code> handlers. In latter case
pass <code>config.async = true</code> and make sure that <code>proc</code> accepts callback as
4th parameter and calls it when async operation completes or fails.</p>

<p>WirePattern sends group packets, sends data packets emitted by <code>proc</code>
via its <code>outputPort</code> argument, then closes groups and disconnects
automatically.</p>                            <div class="highlight"><pre><span class="nv">exports.WirePattern = </span><span class="nf">(component, config, proc) -&gt;</span></pre></div>                                                  <p>In ports</p>                            <div class="highlight"><pre>  <span class="nv">inPorts = </span><span class="k">if</span> <span class="s">&#39;in&#39;</span> <span class="k">of</span> <span class="nx">config</span> <span class="k">then</span> <span class="nx">config</span><span class="p">.</span><span class="nx">in</span> <span class="k">else</span> <span class="s">&#39;in&#39;</span>
  <span class="nv">inPorts = </span><span class="p">[</span> <span class="nx">inPorts</span> <span class="p">]</span> <span class="k">unless</span> <span class="nx">inPorts</span> <span class="k">instanceof</span> <span class="nb">Array</span></pre></div>                                                  <p>Out ports</p>                            <div class="highlight"><pre>  <span class="nv">outPorts = </span><span class="k">if</span> <span class="s">&#39;out&#39;</span> <span class="k">of</span> <span class="nx">config</span> <span class="k">then</span> <span class="nx">config</span><span class="p">.</span><span class="nx">out</span> <span class="k">else</span> <span class="s">&#39;out&#39;</span>
  <span class="nv">outPorts = </span><span class="p">[</span> <span class="nx">outPorts</span> <span class="p">]</span> <span class="k">unless</span> <span class="nx">outPorts</span> <span class="k">instanceof</span> <span class="nb">Array</span></pre></div>                                                  <p>For async process</p>                            <div class="highlight"><pre>  <span class="nv">config.async = </span><span class="kc">false</span> <span class="k">unless</span> <span class="s">&#39;async&#39;</span> <span class="k">of</span> <span class="nx">config</span></pre></div>                                                  <p>Keep correct output order for async mode</p>                            <div class="highlight"><pre>  <span class="nv">config.ordered = </span><span class="kc">false</span> <span class="k">unless</span> <span class="s">&#39;ordered&#39;</span> <span class="k">of</span> <span class="nx">config</span></pre></div>                                                  <p>Group requests by group ID</p>                            <div class="highlight"><pre>  <span class="nv">config.group = </span><span class="kc">false</span> <span class="k">unless</span> <span class="s">&#39;group&#39;</span> <span class="k">of</span> <span class="nx">config</span></pre></div>                                                  <p>Group requests by object field</p>                            <div class="highlight"><pre>  <span class="nv">config.field = </span><span class="kc">null</span> <span class="k">unless</span> <span class="s">&#39;field&#39;</span> <span class="k">of</span> <span class="nx">config</span></pre></div>                                                  <p>Forward group events from specific inputs to the output:
- false: don't forward anything
- true: forward unique groups of all inputs
- string: forward groups of a specific port only
- array: forward unique groups of inports in the list</p>                            <div class="highlight"><pre>  <span class="nv">config.forwardGroups = </span><span class="kc">false</span> <span class="k">unless</span> <span class="s">&#39;forwardGroups&#39;</span> <span class="k">of</span> <span class="nx">config</span></pre></div>                                                  <p>Receive streams feature</p>                            <div class="highlight"><pre>  <span class="nv">config.receiveStreams = </span><span class="kc">false</span> <span class="k">unless</span> <span class="s">&#39;receiveStreams&#39;</span> <span class="k">of</span> <span class="nx">config</span>
  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">config</span><span class="p">.</span><span class="nx">receiveStreams</span> <span class="o">is</span> <span class="s">&#39;string&#39;</span>
    <span class="nv">config.receiveStreams = </span><span class="p">[</span> <span class="nx">config</span><span class="p">.</span><span class="nx">receiveStreams</span> <span class="p">]</span></pre></div>                                                  <p>Send streams feature</p>                            <div class="highlight"><pre>  <span class="nv">config.sendStreams = </span><span class="kc">false</span> <span class="k">unless</span> <span class="s">&#39;sendStreams&#39;</span> <span class="k">of</span> <span class="nx">config</span>
  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">config</span><span class="p">.</span><span class="nx">sendStreams</span> <span class="o">is</span> <span class="s">&#39;string&#39;</span>
    <span class="nv">config.sendStreams = </span><span class="p">[</span> <span class="nx">config</span><span class="p">.</span><span class="nx">sendStreams</span> <span class="p">]</span>
  <span class="nv">config.sendStreams = </span><span class="nx">outPorts</span> <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">async</span>

  <span class="nv">collectGroups = </span><span class="nx">config</span><span class="p">.</span><span class="nx">forwardGroups</span></pre></div>                                                  <p>Collect groups from each port?</p>                            <div class="highlight"><pre>  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">collectGroups</span> <span class="o">is</span> <span class="s">&#39;boolean&#39;</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">config</span><span class="p">.</span><span class="nx">group</span>
    <span class="nv">collectGroups = </span><span class="nx">inPorts</span></pre></div>                                                  <p>Collect groups from one and only port?</p>                            <div class="highlight"><pre>  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">collectGroups</span> <span class="o">is</span> <span class="s">&#39;string&#39;</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">config</span><span class="p">.</span><span class="nx">group</span>
    <span class="nv">collectGroups = </span><span class="p">[</span><span class="nx">collectGroups</span><span class="p">]</span></pre></div>                                                  <p>Collect groups from any port, as we group by them</p>                            <div class="highlight"><pre>  <span class="k">if</span> <span class="nx">collectGroups</span> <span class="o">isnt</span> <span class="kc">false</span> <span class="o">and</span> <span class="nx">config</span><span class="p">.</span><span class="nx">group</span>
    <span class="nv">collectGroups = </span><span class="kc">true</span>

  <span class="k">for</span> <span class="nx">name</span> <span class="k">in</span> <span class="nx">inPorts</span>
    <span class="k">unless</span> <span class="nx">component</span><span class="p">.</span><span class="nx">inPorts</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&quot;no inPort named &#39;</span><span class="si">#{</span><span class="nx">name</span><span class="si">}</span><span class="s">&#39;&quot;</span>
  <span class="k">for</span> <span class="nx">name</span> <span class="k">in</span> <span class="nx">outPorts</span>
    <span class="k">unless</span> <span class="nx">component</span><span class="p">.</span><span class="nx">outPorts</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&quot;no outPort named &#39;</span><span class="si">#{</span><span class="nx">name</span><span class="si">}</span><span class="s">&#39;&quot;</span>

  <span class="nv">groupedData = </span><span class="p">{}</span>
  <span class="nv">groupedDataGroups = </span><span class="p">{}</span></pre></div>                                                  <p>For ordered output</p>                            <div class="highlight"><pre>  <span class="nv">q = </span><span class="p">[]</span>
  <span class="nv">processQueue = </span><span class="nf">-&gt;</span>
    <span class="k">while</span> <span class="nx">q</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="nv">streams = </span><span class="nx">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></pre></div>                                                  <p>At least one of the outputs has to be resolved
for output streams to be flushed.</p>                            <div class="highlight"><pre>      <span class="nv">flushed = </span><span class="kc">false</span>
      <span class="k">if</span> <span class="nx">outPorts</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nx">streams</span><span class="p">.</span><span class="nx">resolved</span>
          <span class="nv">flushed = </span><span class="nx">streams</span><span class="p">.</span><span class="nx">flush</span><span class="p">()</span>
          <span class="nx">q</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span> <span class="k">if</span> <span class="nx">flushed</span>
      <span class="k">else</span>
        <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">stream</span> <span class="k">of</span> <span class="nx">streams</span>
          <span class="k">if</span> <span class="nx">stream</span><span class="p">.</span><span class="nx">resolved</span>
            <span class="nv">flushed = </span><span class="nx">stream</span><span class="p">.</span><span class="nx">flush</span><span class="p">()</span>
            <span class="nx">q</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span> <span class="k">if</span> <span class="nx">flushed</span>
      <span class="k">return</span> <span class="k">unless</span> <span class="nx">flushed</span>

  <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">async</span>
    <span class="nv">component.load = </span><span class="mi">0</span> <span class="k">if</span> <span class="s">&#39;load&#39;</span> <span class="k">of</span> <span class="nx">component</span><span class="p">.</span><span class="nx">outPorts</span></pre></div>                                                  <p>Create before and after hooks</p>                            <div class="highlight"><pre>    <span class="nv">component.beforeProcess = </span><span class="nf">(outs) -&gt;</span>
      <span class="nx">q</span><span class="p">.</span><span class="nx">push</span> <span class="nx">outs</span> <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">ordered</span>
      <span class="nx">component</span><span class="p">.</span><span class="nx">load</span><span class="o">++</span>
      <span class="k">if</span> <span class="s">&#39;load&#39;</span> <span class="k">of</span> <span class="nx">component</span><span class="p">.</span><span class="nx">outPorts</span> <span class="o">and</span> <span class="nx">component</span><span class="p">.</span><span class="nx">outPorts</span><span class="p">.</span><span class="nx">load</span><span class="p">.</span><span class="nx">isAttached</span><span class="p">()</span>
        <span class="nx">component</span><span class="p">.</span><span class="nx">outPorts</span><span class="p">.</span><span class="nx">load</span><span class="p">.</span><span class="nx">send</span> <span class="nx">component</span><span class="p">.</span><span class="nx">load</span>
        <span class="nx">component</span><span class="p">.</span><span class="nx">outPorts</span><span class="p">.</span><span class="nx">load</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">()</span>
    <span class="nv">component.afterProcess = </span><span class="nf">(err, outs) -&gt;</span>
      <span class="nx">processQueue</span><span class="p">()</span>
      <span class="nx">component</span><span class="p">.</span><span class="nx">load</span><span class="o">--</span>
      <span class="k">if</span> <span class="s">&#39;load&#39;</span> <span class="k">of</span> <span class="nx">component</span><span class="p">.</span><span class="nx">outPorts</span> <span class="o">and</span> <span class="nx">component</span><span class="p">.</span><span class="nx">outPorts</span><span class="p">.</span><span class="nx">load</span><span class="p">.</span><span class="nx">isAttached</span><span class="p">()</span>
        <span class="nx">component</span><span class="p">.</span><span class="nx">outPorts</span><span class="p">.</span><span class="nx">load</span><span class="p">.</span><span class="nx">send</span> <span class="nx">component</span><span class="p">.</span><span class="nx">load</span>
        <span class="nx">component</span><span class="p">.</span><span class="nx">outPorts</span><span class="p">.</span><span class="nx">load</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">()</span>

  <span class="k">for</span> <span class="nx">port</span> <span class="k">in</span> <span class="nx">inPorts</span>
    <span class="nx">do</span> <span class="nf">(port) -&gt;</span></pre></div>                                                  <p>Support for StreamReceiver ports</p>                            <div class="highlight"><pre>      <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">receiveStreams</span> <span class="o">and</span> <span class="nx">config</span><span class="p">.</span><span class="nx">receiveStreams</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">port</span><span class="p">)</span> <span class="o">isnt</span> <span class="o">-</span><span class="mi">1</span>
        <span class="nv">inPort = </span><span class="k">new</span> <span class="nx">StreamReceiver</span> <span class="nx">component</span><span class="p">.</span><span class="nx">inPorts</span><span class="p">[</span><span class="nx">port</span><span class="p">]</span>
      <span class="k">else</span>
        <span class="nv">inPort = </span><span class="nx">component</span><span class="p">.</span><span class="nx">inPorts</span><span class="p">[</span><span class="nx">port</span><span class="p">]</span>
      <span class="nv">inPort.groups = </span><span class="p">[]</span></pre></div>                                                  <p>Set processing callback</p>                            <div class="highlight"><pre>      <span class="nv">inPort.process = </span><span class="nf">(event, payload) -&gt;</span>
        <span class="k">switch</span> <span class="nx">event</span>
          <span class="k">when</span> <span class="s">&#39;begingroup&#39;</span>
            <span class="nx">inPort</span><span class="p">.</span><span class="nx">groups</span><span class="p">.</span><span class="nx">push</span> <span class="nx">payload</span>
          <span class="k">when</span> <span class="s">&#39;endgroup&#39;</span>
            <span class="nx">inPort</span><span class="p">.</span><span class="nx">groups</span><span class="p">.</span><span class="nx">pop</span><span class="p">()</span>

          <span class="k">when</span> <span class="s">&#39;data&#39;</span>
            <span class="nv">key = </span><span class="s">&#39;&#39;</span>
            <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">group</span> <span class="o">and</span> <span class="nx">inPort</span><span class="p">.</span><span class="nx">groups</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
              <span class="nv">key = </span><span class="nx">inPort</span><span class="p">.</span><span class="nx">groups</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
              <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">group</span> <span class="k">instanceof</span> <span class="nb">RegExp</span>
                <span class="nv">key = </span><span class="s">&#39;&#39;</span> <span class="k">unless</span> <span class="nx">config</span><span class="p">.</span><span class="nx">group</span><span class="p">.</span><span class="nx">test</span> <span class="nx">key</span>
            <span class="k">else</span> <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">field</span> <span class="o">and</span> <span class="k">typeof</span><span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="o">is</span> <span class="s">&#39;object&#39;</span> <span class="o">and</span>
            <span class="nx">config</span><span class="p">.</span><span class="nx">field</span> <span class="k">of</span> <span class="nx">payload</span>
              <span class="nv">key = </span><span class="nx">payload</span><span class="p">[</span><span class="nx">config</span><span class="p">.</span><span class="nx">field</span><span class="p">]</span>

            <span class="nx">groupedData</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">unless</span> <span class="nx">key</span> <span class="k">of</span> <span class="nx">groupedData</span>
            <span class="nx">groupedData</span><span class="p">[</span><span class="nx">key</span><span class="p">][</span><span class="nx">config</span><span class="p">.</span><span class="nx">field</span><span class="p">]</span> <span class="o">=</span> <span class="nx">key</span> <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">field</span>
            <span class="k">if</span> <span class="nx">inPorts</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span>
              <span class="nx">groupedData</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">payload</span>
            <span class="k">else</span>
              <span class="nx">groupedData</span><span class="p">[</span><span class="nx">key</span><span class="p">][</span><span class="nx">port</span><span class="p">]</span> <span class="o">=</span> <span class="nx">payload</span></pre></div>                                                  <p>Collect unique groups from multiple ports if necessary</p>                            <div class="highlight"><pre>            <span class="k">if</span> <span class="nx">collectGroups</span> <span class="k">instanceof</span> <span class="nb">Array</span> <span class="o">and</span>
            <span class="nx">collectGroups</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">port</span><span class="p">)</span> <span class="o">isnt</span> <span class="o">-</span><span class="mi">1</span>
              <span class="nx">groupedDataGroups</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">unless</span> <span class="nx">key</span> <span class="k">of</span> <span class="nx">groupedDataGroups</span>
              <span class="k">for</span> <span class="nx">grp</span> <span class="k">in</span> <span class="nx">inPort</span><span class="p">.</span><span class="nx">groups</span>
                <span class="k">if</span> <span class="nx">groupedDataGroups</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">grp</span><span class="p">)</span> <span class="o">is</span> <span class="o">-</span><span class="mi">1</span>
                  <span class="nx">groupedDataGroups</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">push</span> <span class="nx">grp</span></pre></div>                                                  <p>Flush the data if the tuple is complete</p>                            <div class="highlight"><pre>            <span class="nv">requiredLength = </span><span class="nx">inPorts</span><span class="p">.</span><span class="nx">length</span>
            <span class="o">++</span><span class="nx">requiredLength</span> <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">field</span>
            <span class="k">if</span> <span class="nx">requiredLength</span> <span class="o">is</span> <span class="mi">1</span> <span class="o">or</span>
            <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">groupedData</span><span class="p">[</span><span class="nx">key</span><span class="p">]).</span><span class="nx">length</span> <span class="o">is</span> <span class="nx">requiredLength</span>
              <span class="k">if</span> <span class="nx">collectGroups</span> <span class="o">is</span> <span class="kc">true</span>
                <span class="nv">groups = </span><span class="nx">inPort</span><span class="p">.</span><span class="nx">groups</span>
              <span class="k">else</span>
                <span class="nv">groups = </span><span class="nx">groupedDataGroups</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span></pre></div>                                                  <p>Reset port group buffers or it may keep them for next turn</p>                            <div class="highlight"><pre>              <span class="nx">component</span><span class="p">.</span><span class="nx">inPorts</span><span class="p">[</span><span class="nx">p</span><span class="p">].</span><span class="nv">groups = </span><span class="p">[]</span> <span class="k">for</span> <span class="nx">p</span> <span class="k">in</span> <span class="nx">inPorts</span></pre></div>                                                  <p>Prepare outputs</p>                            <div class="highlight"><pre>              <span class="nv">outs = </span><span class="p">{}</span>
              <span class="k">for</span> <span class="nx">name</span> <span class="k">in</span> <span class="nx">outPorts</span>
                <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">async</span> <span class="o">or</span> <span class="nx">config</span><span class="p">.</span><span class="nx">sendStreams</span> <span class="o">and</span>
                <span class="nx">config</span><span class="p">.</span><span class="nx">sendStreams</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="o">isnt</span> <span class="o">-</span><span class="mi">1</span>
                  <span class="nx">outs</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">StreamSender</span> <span class="nx">component</span><span class="p">.</span><span class="nx">outPorts</span><span class="p">[</span><span class="nx">name</span><span class="p">],</span> <span class="nx">config</span><span class="p">.</span><span class="nx">ordered</span>
                <span class="k">else</span>
                  <span class="nx">outs</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">component</span><span class="p">.</span><span class="nx">outPorts</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span>

              <span class="nv">outs = </span><span class="nx">outs</span><span class="p">[</span><span class="nx">outPorts</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">if</span> <span class="nx">outPorts</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span> <span class="c1"># for simplicity</span>

              <span class="nv">whenDone = </span><span class="nf">(err) -&gt;</span>
                <span class="k">if</span> <span class="nx">err</span>
                  <span class="nx">component</span><span class="p">.</span><span class="nx">error</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">groups</span></pre></div>                                                  <p>For use with MultiError trait</p>                            <div class="highlight"><pre>                <span class="k">if</span> <span class="k">typeof</span> <span class="nx">component</span><span class="p">.</span><span class="nx">fail</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span> <span class="o">and</span> <span class="nx">component</span><span class="p">.</span><span class="nx">hasErrors</span>
                  <span class="nx">component</span><span class="p">.</span><span class="nx">fail</span><span class="p">()</span></pre></div>                                                  <p>Disconnect outputs if still connected,
this also indicates them as resolved if pending</p>                            <div class="highlight"><pre>                <span class="k">if</span> <span class="nx">outPorts</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span>
                  <span class="nx">outs</span><span class="p">.</span><span class="nx">endGroup</span><span class="p">()</span> <span class="k">for</span> <span class="nx">g</span> <span class="k">in</span> <span class="nx">groups</span> <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">forwardGroups</span>
                  <span class="nx">outs</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">()</span>
                <span class="k">else</span>
                  <span class="k">for</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">out</span> <span class="k">of</span> <span class="nx">outs</span>
                    <span class="nx">out</span><span class="p">.</span><span class="nx">endGroup</span><span class="p">()</span> <span class="k">for</span> <span class="nx">g</span> <span class="k">in</span> <span class="nx">groups</span> <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">forwardGroups</span>
                    <span class="nx">out</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">()</span>
                <span class="k">if</span> <span class="k">typeof</span> <span class="nx">component</span><span class="p">.</span><span class="nx">afterProcess</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span>
                  <span class="nx">component</span><span class="p">.</span><span class="nx">afterProcess</span> <span class="nx">err</span> <span class="o">or</span> <span class="nx">component</span><span class="p">.</span><span class="nx">hasErrors</span><span class="p">,</span> <span class="nx">outs</span></pre></div>                                                  <p>Prepare data</p>                            <div class="highlight"><pre>              <span class="nv">data = </span><span class="nx">groupedData</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span></pre></div>                                                  <p>Clean buffers</p>                            <div class="highlight"><pre>              <span class="k">delete</span> <span class="nx">groupedData</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
              <span class="k">delete</span> <span class="nx">groupedDataGroups</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span></pre></div>                                                  <p>Before hook</p>                            <div class="highlight"><pre>              <span class="k">if</span> <span class="k">typeof</span> <span class="nx">component</span><span class="p">.</span><span class="nx">beforeProcess</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span>
                <span class="nx">component</span><span class="p">.</span><span class="nx">beforeProcess</span> <span class="nx">outs</span></pre></div>                                                  <p>Group forwarding</p>                            <div class="highlight"><pre>              <span class="k">if</span> <span class="nx">outPorts</span><span class="p">.</span><span class="nx">length</span> <span class="o">is</span> <span class="mi">1</span>
                <span class="nx">outs</span><span class="p">.</span><span class="nx">beginGroup</span> <span class="nx">g</span> <span class="k">for</span> <span class="nx">g</span> <span class="k">in</span> <span class="nx">groups</span> <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">forwardGroups</span>
              <span class="k">else</span>
                <span class="k">for</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">out</span> <span class="k">of</span> <span class="nx">outs</span>
                  <span class="nx">out</span><span class="p">.</span><span class="nx">beginGroup</span> <span class="nx">g</span> <span class="k">for</span> <span class="nx">g</span> <span class="k">in</span> <span class="nx">groups</span> <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">forwardGroups</span></pre></div>                                                  <p>Call the proc function</p>                            <div class="highlight"><pre>              <span class="k">if</span> <span class="nx">config</span><span class="p">.</span><span class="nx">async</span>
                <span class="nx">proc</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">groups</span><span class="p">,</span> <span class="nx">outs</span><span class="p">,</span> <span class="nx">whenDone</span>
              <span class="k">else</span>
                <span class="nx">proc</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">groups</span><span class="p">,</span> <span class="nx">outs</span>
                <span class="nx">whenDone</span><span class="p">()</span></pre></div>                                                  <p>Make it chainable or usable at the end of getComponent()</p>                            <div class="highlight"><pre>  <span class="k">return</span> <span class="nx">component</span></pre></div>                                                  <p>Alias for compatibility with 0.5.3</p>                            <div class="highlight"><pre><span class="nv">exports.GroupedInput = </span><span class="nx">exports</span><span class="p">.</span><span class="nx">WirePattern</span></pre></div>                                                  <p><code>CustomError</code> is an error class carrying additional information provided
as its constructor argument.</p>                            <div class="highlight"><pre><span class="k">class</span> <span class="nx">CustomError</span> <span class="k">extends</span> <span class="nb">Error</span>
  <span class="nv">constructor: </span><span class="nf">(message, options) -&gt;</span>
    <span class="k">super</span> <span class="nx">message</span>
    <span class="k">for</span> <span class="k">own</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">val</span> <span class="k">of</span> <span class="nx">options</span>
      <span class="nx">@</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span>

<span class="nv">exports.CustomError = </span><span class="nx">CustomError</span></pre></div>                                                  <p><code>MultiError</code> simplifies throwing and handling multiple error objects
during a single component activation.</p>

<p><code>group</code> is an optional group ID which will be used to wrap all error
packets emitted by the component.</p>                            <div class="highlight"><pre><span class="nv">exports.MultiError = </span><span class="nf">(component, group = &#39;&#39;, errorPort = &#39;error&#39;) -&gt;</span>
  <span class="k">unless</span> <span class="nx">errorPort</span> <span class="k">of</span> <span class="nx">component</span><span class="p">.</span><span class="nx">outPorts</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span> <span class="s">&quot;Missing error port &#39;</span><span class="si">#{</span><span class="nx">errorPort</span><span class="si">}</span><span class="s">&#39;&quot;</span>

  <span class="nv">component.hasErrors = </span><span class="kc">false</span>
  <span class="nv">component.errors = </span><span class="p">[]</span></pre></div>                                                  <p>Override component.error to support group information</p>                            <div class="highlight"><pre>  <span class="nv">component.error = </span><span class="nf">(e, groups = []) -&gt;</span>
    <span class="nx">component</span><span class="p">.</span><span class="nx">errors</span><span class="p">.</span><span class="nx">push</span>
      <span class="nv">err: </span><span class="nx">e</span>
      <span class="nv">groups: </span><span class="nx">groups</span>
    <span class="nv">component.hasErrors = </span><span class="kc">true</span></pre></div>                                                  <p>Fail method should be called to terminate process immediately
or to flush error packets.</p>                            <div class="highlight"><pre>  <span class="nv">component.fail = </span><span class="nf">(e = null, groups = []) -&gt;</span>
    <span class="nx">component</span><span class="p">.</span><span class="nx">error</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">groups</span> <span class="k">if</span> <span class="nx">e</span>
    <span class="k">return</span> <span class="k">unless</span> <span class="nx">component</span><span class="p">.</span><span class="nx">hasErrors</span>
    <span class="nx">component</span><span class="p">.</span><span class="nx">outPorts</span><span class="p">[</span><span class="nx">errorPort</span><span class="p">].</span><span class="nx">beginGroup</span> <span class="nx">group</span> <span class="k">if</span> <span class="nx">group</span>
    <span class="k">for</span> <span class="nx">error</span> <span class="k">in</span> <span class="nx">component</span><span class="p">.</span><span class="nx">errors</span>
      <span class="nx">component</span><span class="p">.</span><span class="nx">outPorts</span><span class="p">[</span><span class="nx">errorPort</span><span class="p">].</span><span class="nx">beginGroup</span> <span class="nx">grp</span> <span class="k">for</span> <span class="nx">grp</span> <span class="k">in</span> <span class="nx">error</span><span class="p">.</span><span class="nx">groups</span>
      <span class="nx">component</span><span class="p">.</span><span class="nx">outPorts</span><span class="p">[</span><span class="nx">errorPort</span><span class="p">].</span><span class="nx">send</span> <span class="nx">error</span><span class="p">.</span><span class="nx">err</span>
      <span class="nx">component</span><span class="p">.</span><span class="nx">outPorts</span><span class="p">[</span><span class="nx">errorPort</span><span class="p">].</span><span class="nx">endGroup</span><span class="p">()</span> <span class="k">for</span> <span class="nx">grp</span> <span class="k">in</span> <span class="nx">error</span><span class="p">.</span><span class="nx">groups</span>
    <span class="nx">component</span><span class="p">.</span><span class="nx">outPorts</span><span class="p">[</span><span class="nx">errorPort</span><span class="p">].</span><span class="nx">endGroup</span><span class="p">()</span> <span class="k">if</span> <span class="nx">group</span>
    <span class="nx">component</span><span class="p">.</span><span class="nx">outPorts</span><span class="p">[</span><span class="nx">errorPort</span><span class="p">].</span><span class="nx">disconnect</span><span class="p">()</span></pre></div>                                                  <p>Clean the status for next activation</p>                            <div class="highlight"><pre>    <span class="nv">component.hasErrors = </span><span class="kc">false</span>
    <span class="nv">component.errors = </span><span class="p">[]</span>

  <span class="k">return</span> <span class="nx">component</span>

</pre></div>                                   <p><small>This page contains documentation generated automatically on 2014-06-14 from NoFlo's <a href="https://github.com/noflo/noflo/blob/master/src/lib/Helpers.coffee">Helpers.coffee</a> file.</small></p>         </div>       </div>     </div>   </div> 